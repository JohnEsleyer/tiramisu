{
  "version": 3,
  "sources": ["../../src/webgl/TiramisuRenderer.ts", "../../src/webgl/TextureManager.ts", "../../src/webgl/shaders/ShaderLibrary.ts", "../../src/webgl/ShaderManager.ts", "../../src/webgl/WebCodecsVideoSource.ts", "../../src/webgl/EffectStack.ts", "../../src/TiramisuEditor.ts", "app.ts"],
  "sourcesContent": ["import { \n    WebGLRenderContext, \n    ShaderProgram, \n    Effect, \n    WebGLLayer, \n    ShaderUniform,\n    RenderConfig \n} from '../types.js';\n\nexport class TiramisuRenderer {\n    private gl: WebGL2RenderingContext;\n    private canvas: HTMLCanvasElement;\n    private width: number;\n    private height: number;\n    \n    // Ping-pong framebuffers for multi-pass rendering\n    private framebuffers!: [WebGLFramebuffer, WebGLFramebuffer];\n    private frameTextures!: [WebGLTexture, WebGLTexture];\n    private currentBufferIndex: number = 0;\n    \n    // Shared quad vertex buffer (covers entire viewport)\n    private quadBuffer!: WebGLBuffer;\n    \n    // Shader management\n    private shaders: Map<string, ShaderProgram> = new Map();\n    private currentProgram: WebGLProgram | null = null;\n    \n    // Default pass-through shader\n    private defaultShaderId: string = 'passthrough';\n    \n    constructor(canvas: HTMLCanvasElement, config: Partial<RenderConfig> = {}) {\n        this.canvas = canvas;\n        this.width = config.width || 1920;\n        this.height = config.height || 1080;\n        \n        canvas.width = this.width;\n        canvas.height = this.height;\n        \n        const gl = canvas.getContext('webgl2', config.webglContextAttributes);\n        if (!gl) {\n            throw new Error('WebGL2 not supported');\n        }\n        this.gl = gl;\n        \n        this.setupGLState();\n        this.createFramebuffers();\n        this.createSharedQuad();\n        this.createDefaultShaders();\n    }\n    \n    private setupGLState(): void {\n        const gl = this.gl;\n        \n        // Set viewport to cover entire canvas\n        gl.viewport(0, 0, this.width, this.height);\n        \n        // Enable blending for transparency\n        gl.enable(gl.BLEND);\n        gl.blendFunc(gl.SRC_ALPHA, gl.ONE_MINUS_SRC_ALPHA);\n        \n        // Create and bind vertex array for the shared quad\n        const vao = gl.createVertexArray();\n        if (vao) {\n            gl.bindVertexArray(vao);\n        }\n    }\n    \n    private createFramebuffers(): void {\n        const gl = this.gl;\n        \n        // Create two framebuffers for ping-pong rendering\n        this.framebuffers = [\n            gl.createFramebuffer()!,\n            gl.createFramebuffer()!\n        ];\n        \n        // Create corresponding textures\n        this.frameTextures = [\n            gl.createTexture()!,\n            gl.createTexture()!\n        ];\n        \n        // Initialize framebuffers and textures\n        for (let i = 0; i < 2; i++) {\n            gl.bindTexture(gl.TEXTURE_2D, this.frameTextures[i]);\n            gl.texImage2D(\n                gl.TEXTURE_2D,\n                0,\n                gl.RGBA,\n                this.width,\n                this.height,\n                0,\n                gl.RGBA,\n                gl.UNSIGNED_BYTE,\n                null\n            );\n            \n            // Set texture parameters for optimal rendering\n            gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MIN_FILTER, gl.LINEAR);\n            gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MAG_FILTER, gl.LINEAR);\n            gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_S, gl.CLAMP_TO_EDGE);\n            gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_T, gl.CLAMP_TO_EDGE);\n            \n            gl.bindFramebuffer(gl.FRAMEBUFFER, this.framebuffers[i]);\n            gl.framebufferTexture2D(\n                gl.FRAMEBUFFER,\n                gl.COLOR_ATTACHMENT0,\n                gl.TEXTURE_2D,\n                this.frameTextures[i],\n                0\n            );\n        }\n        \n        // Clean up bindings\n        gl.bindTexture(gl.TEXTURE_2D, null);\n        gl.bindFramebuffer(gl.FRAMEBUFFER, null);\n    }\n    \n    private createSharedQuad(): void {\n        const gl = this.gl;\n        \n        // Create a quad that covers the entire viewport\n        // Two triangles forming a square with UV coordinates\n        const vertices = new Float32Array([\n            // Position (x, y)  UV coordinates (u, v)\n            -1.0, -1.0,       0.0, 1.0,  // Bottom-left\n             1.0, -1.0,       1.0, 1.0,  // Bottom-right\n            -1.0,  1.0,       0.0, 0.0,  // Top-left\n             1.0,  1.0,       1.0, 0.0,  // Top-right\n        ]);\n        \n        this.quadBuffer = gl.createBuffer()!;\n        gl.bindBuffer(gl.ARRAY_BUFFER, this.quadBuffer);\n        gl.bufferData(gl.ARRAY_BUFFER, vertices, gl.STATIC_DRAW);\n        gl.bindBuffer(gl.ARRAY_BUFFER, null);\n    }\n    \n    private createDefaultShaders(): void {\n        // Pass-through vertex shader\n        const vertexShaderSource = `#version 300 es\n            in vec2 a_position;\n            in vec2 a_texCoord;\n            out vec2 v_texCoord;\n            \n            void main() {\n                gl_Position = vec4(a_position, 0.0, 1.0);\n                v_texCoord = a_texCoord;\n            }\n        `;\n        \n        // Pass-through fragment shader with alpha support\n        const fragmentShaderSource = `#version 300 es\n            precision highp float;\n            in vec2 v_texCoord;\n            uniform sampler2D u_sourceTexture;\n            uniform float u_opacity;\n            uniform vec2 u_resolution;\n            out vec4 fragColor;\n            \n            void main() {\n                vec4 color = texture(u_sourceTexture, v_texCoord);\n                color.a *= u_opacity;\n                fragColor = color;\n            }\n        `;\n        \n        this.createShaderProgram(\n            this.defaultShaderId,\n            vertexShaderSource,\n            fragmentShaderSource\n        );\n    }\n    \n    createShaderProgram(\n        id: string, \n        vertexShaderSource: string, \n        fragmentShaderSource: string\n    ): void {\n        const gl = this.gl;\n        \n        // Compile vertex shader\n        const vertexShader = gl.createShader(gl.VERTEX_SHADER)!;\n        gl.shaderSource(vertexShader, vertexShaderSource);\n        gl.compileShader(vertexShader);\n        \n        if (!gl.getShaderParameter(vertexShader, gl.COMPILE_STATUS)) {\n            const error = gl.getShaderInfoLog(vertexShader);\n            gl.deleteShader(vertexShader);\n            throw new Error(`Vertex shader compilation failed: ${error}`);\n        }\n        \n        // Compile fragment shader\n        const fragmentShader = gl.createShader(gl.FRAGMENT_SHADER)!;\n        gl.shaderSource(fragmentShader, fragmentShaderSource);\n        gl.compileShader(fragmentShader);\n        \n        if (!gl.getShaderParameter(fragmentShader, gl.COMPILE_STATUS)) {\n            const error = gl.getShaderInfoLog(fragmentShader);\n            gl.deleteShader(vertexShader);\n            gl.deleteShader(fragmentShader);\n            throw new Error(`Fragment shader compilation failed: ${error}`);\n        }\n        \n        // Create and link program\n        const program = gl.createProgram()!;\n        gl.attachShader(program, vertexShader);\n        gl.attachShader(program, fragmentShader);\n        gl.linkProgram(program);\n        \n        if (!gl.getProgramParameter(program, gl.LINK_STATUS)) {\n            const error = gl.getProgramInfoLog(program);\n            gl.deleteProgram(program);\n            throw new Error(`Shader program linking failed: ${error}`);\n        }\n        \n        // Store uniform and attribute locations\n        const uniforms = new Map<string, WebGLUniformLocation>();\n        const attributes = new Map<string, number>();\n        \n        // Get standard uniforms\n        uniforms.set('u_sourceTexture', gl.getUniformLocation(program, 'u_sourceTexture')!);\n        \n        // Get standard attributes\n        attributes.set('a_position', gl.getAttribLocation(program, 'a_position')!);\n        attributes.set('a_texCoord', gl.getAttribLocation(program, 'a_texCoord')!);\n        \n        // Store shader program\n        this.shaders.set(id, {\n            id,\n            program,\n            uniforms,\n            attributes\n        });\n        \n        // Clean up shader objects (they're now linked to the program)\n        gl.deleteShader(vertexShader);\n        gl.deleteShader(fragmentShader);\n    }\n    \n    useShader(id: string): void {\n        const shader = this.shaders.get(id);\n        if (!shader) {\n            throw new Error(`Shader '${id}' not found`);\n        }\n        \n        if (this.currentProgram !== shader.program) {\n            const gl = this.gl;\n            gl.useProgram(shader.program);\n            this.currentProgram = shader.program;\n            \n            // Set up shared quad attributes (they're the same for all shaders)\n            this.setupQuadAttributes(shader);\n        }\n    }\n    \n    private setupQuadAttributes(shader: ShaderProgram): void {\n        const gl = this.gl;\n        \n        gl.bindBuffer(gl.ARRAY_BUFFER, this.quadBuffer);\n        \n        // Set up position attribute\n        const positionLoc = shader.attributes.get('a_position');\n        if (positionLoc !== undefined) {\n            gl.enableVertexAttribArray(positionLoc);\n            gl.vertexAttribPointer(positionLoc, 2, gl.FLOAT, false, 16, 0);\n        }\n        \n        // Set up texture coordinate attribute\n        const texCoordLoc = shader.attributes.get('a_texCoord');\n        if (texCoordLoc !== undefined) {\n            gl.enableVertexAttribArray(texCoordLoc);\n            gl.vertexAttribPointer(texCoordLoc, 2, gl.FLOAT, false, 16, 8);\n        }\n        \n        gl.bindBuffer(gl.ARRAY_BUFFER, null);\n    }\n    \n    setUniform(shaderId: string, uniformName: string, value: ShaderUniform): void {\n        const shader = this.shaders.get(shaderId);\n        if (!shader) return;\n        \n        const gl = this.gl;\n        const location = shader.uniforms.get(uniformName);\n        if (!location) return;\n        \n        this.useShader(shaderId);\n        \n        if (typeof value === 'number') {\n            gl.uniform1f(location, value);\n        } else if (typeof value === 'boolean') {\n            gl.uniform1i(location, value ? 1 : 0);\n        } else if (value instanceof WebGLTexture) {\n            // For textures, we need to bind to a texture unit\n            gl.activeTexture(gl.TEXTURE0);\n            gl.bindTexture(gl.TEXTURE_2D, value);\n            gl.uniform1i(location, 0);\n        } else if (Array.isArray(value)) {\n            if (value.length === 2) {\n                gl.uniform2fv(location, value);\n            } else if (value.length === 3) {\n                gl.uniform3fv(location, value);\n            } else if (value.length === 4) {\n                gl.uniform4fv(location, value);\n            }\n        }\n    }\n    \n    renderToTexture(sourceTexture: WebGLTexture, effects: Effect[] = []): WebGLTexture {\n        const gl = this.gl;\n        \n        // Use ping-pong rendering for multiple effects\n        let inputTexture = sourceTexture;\n        \n        for (let i = 0; i < effects.length; i++) {\n            const effect = effects[i];\n            if (!effect.enabled) continue;\n            \n            // Bind to the current framebuffer\n            const targetBuffer = this.framebuffers[this.currentBufferIndex];\n            gl.bindFramebuffer(gl.FRAMEBUFFER, targetBuffer);\n            \n            // Use the effect's shader\n            this.useShader(effect.shaderId);\n            \n            // Set the input texture\n            this.setUniform(effect.shaderId, 'u_sourceTexture', inputTexture);\n            \n            // Apply effect-specific uniforms\n            Object.entries(effect.uniforms).forEach(([name, value]) => {\n                this.setUniform(effect.shaderId, name, value);\n            });\n            \n            // Render the quad\n            gl.drawArrays(gl.TRIANGLE_STRIP, 0, 4);\n            \n            // Swap buffers: the rendered texture becomes the input for the next pass\n            inputTexture = this.frameTextures[this.currentBufferIndex];\n            this.currentBufferIndex = 1 - this.currentBufferIndex; // Toggle between 0 and 1\n        }\n        \n        // Clean up\n        gl.bindFramebuffer(gl.FRAMEBUFFER, null);\n        \n        return inputTexture;\n    }\n    \n    renderToCanvas(sourceTexture: WebGLTexture, effects: Effect[] = []): void {\n        const gl = this.gl;\n        \n        // First render to texture if there are effects\n        const finalTexture = effects.length > 0 \n            ? this.renderToTexture(sourceTexture, effects)\n            : sourceTexture;\n        \n        // Then render to canvas\n        gl.bindFramebuffer(gl.FRAMEBUFFER, null);\n        \n        // Use default pass-through shader\n        this.useShader(this.defaultShaderId);\n        this.setUniform(this.defaultShaderId, 'u_sourceTexture', finalTexture);\n        this.setUniform(this.defaultShaderId, 'u_opacity', 1.0);\n        this.setUniform(this.defaultShaderId, 'u_resolution', [this.width, this.height]);\n        \n        // Clear canvas\n        gl.clearColor(0, 0, 0, 0);\n        gl.clear(gl.COLOR_BUFFER_BIT);\n        \n        // Render the quad\n        gl.drawArrays(gl.TRIANGLE_STRIP, 0, 4);\n    }\n    \n    createTexture(width?: number, height?: number): WebGLTexture {\n        const gl = this.gl;\n        const texture = gl.createTexture()!;\n        \n        gl.bindTexture(gl.TEXTURE_2D, texture);\n        gl.texImage2D(\n            gl.TEXTURE_2D,\n            0,\n            gl.RGBA,\n            width || this.width,\n            height || this.height,\n            0,\n            gl.RGBA,\n            gl.UNSIGNED_BYTE,\n            null\n        );\n        \n        gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MIN_FILTER, gl.LINEAR);\n        gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MAG_FILTER, gl.LINEAR);\n        gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_S, gl.CLAMP_TO_EDGE);\n        gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_T, gl.CLAMP_TO_EDGE);\n        \n        gl.bindTexture(gl.TEXTURE_2D, null);\n        \n        return texture;\n    }\n    \n    updateTexture(texture: WebGLTexture, source: HTMLImageElement | HTMLCanvasElement | VideoFrame): void {\n        const gl = this.gl;\n        \n        gl.bindTexture(gl.TEXTURE_2D, texture);\n        gl.texSubImage2D(\n            gl.TEXTURE_2D,\n            0,\n            0,\n            0,\n            gl.RGBA,\n            gl.UNSIGNED_BYTE,\n            source\n        );\n        gl.bindTexture(gl.TEXTURE_2D, null);\n    }\n    \n    createWebGLLayer(width?: number, height?: number): WebGLLayer {\n        const texture = this.createTexture(width, height);\n        \n        return {\n            texture,\n            width: width || this.width,\n            height: height || this.height,\n            clear: () => {\n                // Implementation would require rendering a transparent quad to the texture\n                // For now, this is a placeholder\n            },\n            applyShader: (shaderId: string, uniforms: Record<string, ShaderUniform>) => {\n                // Apply shader to this layer's texture\n                const effect: Effect = {\n                    id: `layer_${Date.now()}`,\n                    shaderId,\n                    uniforms,\n                    enabled: true\n                };\n                this.renderToTexture(texture, [effect]);\n            }\n        };\n    }\n    \n    resize(newWidth: number, newHeight: number): void {\n        if (newWidth === this.width && newHeight === this.height) return;\n        \n        this.width = newWidth;\n        this.height = newHeight;\n        this.canvas.width = newWidth;\n        this.canvas.height = newHeight;\n        \n        const gl = this.gl;\n        gl.viewport(0, 0, newWidth, newHeight);\n        \n        // Recreate framebuffers with new dimensions\n        this.createFramebuffers();\n    }\n    \n    dispose(): void {\n        const gl = this.gl;\n        \n        // Clean up framebuffers and textures\n        this.framebuffers.forEach(fb => gl.deleteFramebuffer(fb));\n        this.frameTextures.forEach(tex => gl.deleteTexture(tex));\n        gl.deleteBuffer(this.quadBuffer);\n        \n        // Clean up shaders\n        this.shaders.forEach(shader => {\n            gl.deleteProgram(shader.program);\n        });\n        \n        this.shaders.clear();\n    }\n}", "import { TexturePool, VideoFrameInfo } from '../types.js';\n\nexport class TextureManager implements TexturePool {\n    private gl: WebGL2RenderingContext;\n    private texturePool: WebGLTexture[] = [];\n    private usedTextures: Set<WebGLTexture> = new Set();\n    private assetToTextureMap: Map<string | HTMLImageElement | VideoFrame, WebGLTexture> = new Map();\n    private videoFrameCache: Map<string, VideoFrameInfo[]> = new Map();\n    \n    // Pool configuration\n    private maxPoolSize: number = 32;\n    private defaultTextureWidth: number;\n    private defaultTextureHeight: number;\n    \n    constructor(gl: WebGL2RenderingContext, maxPoolSize: number = 32) {\n        this.gl = gl;\n        this.maxPoolSize = maxPoolSize;\n        this.defaultTextureWidth = 1920;\n        this.defaultTextureHeight = 1080;\n        \n        // Pre-allocate some textures for the pool\n        this.initializePool();\n    }\n    \n    private initializePool(): void {\n        for (let i = 0; i < Math.min(8, this.maxPoolSize); i++) {\n            const texture = this.createTexture();\n            this.texturePool.push(texture);\n        }\n    }\n    \n    private createTexture(width?: number, height?: number): WebGLTexture {\n        const gl = this.gl;\n        const texture = gl.createTexture()!;\n        \n        gl.bindTexture(gl.TEXTURE_2D, texture);\n        gl.texImage2D(\n            gl.TEXTURE_2D,\n            0,\n            gl.RGBA,\n            width || this.defaultTextureWidth,\n            height || this.defaultTextureHeight,\n            0,\n            gl.RGBA,\n            gl.UNSIGNED_BYTE,\n            null\n        );\n        \n        // Set optimal texture parameters for video rendering\n        gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MIN_FILTER, gl.LINEAR);\n        gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MAG_FILTER, gl.LINEAR);\n        gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_S, gl.CLAMP_TO_EDGE);\n        gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_T, gl.CLAMP_TO_EDGE);\n        \n        gl.bindTexture(gl.TEXTURE_2D, null);\n        \n        return texture;\n    }\n    \n    getTexture(): WebGLTexture | null {\n        // Try to get a texture from the pool first\n        if (this.texturePool.length > 0) {\n            const texture = this.texturePool.pop()!;\n            this.usedTextures.add(texture);\n            return texture;\n        }\n        \n        // If pool is empty and we haven't reached max size, create a new texture\n        if (this.usedTextures.size < this.maxPoolSize) {\n            const texture = this.createTexture();\n            this.usedTextures.add(texture);\n            return texture;\n        }\n        \n        // Pool is exhausted\n        console.warn('TextureManager: Pool exhausted, consider increasing maxPoolSize');\n        return null;\n    }\n    \n    releaseTexture(texture: WebGLTexture): void {\n        if (this.usedTextures.has(texture)) {\n            this.usedTextures.delete(texture);\n            this.texturePool.push(texture);\n        }\n    }\n    \n    clear(): void {\n        // Return all used textures to the pool\n        this.usedTextures.forEach(texture => {\n            this.texturePool.push(texture);\n        });\n        this.usedTextures.clear();\n        \n        // Clear asset mappings\n        this.assetToTextureMap.clear();\n        \n        // Clear video frame cache\n        this.videoFrameCache.clear();\n    }\n    \n    // Asset mapping methods\n    getAssetTexture(asset: string | HTMLImageElement | VideoFrame): WebGLTexture | null {\n        return this.assetToTextureMap.get(asset) || null;\n    }\n    \n    setAssetTexture(asset: string | HTMLImageElement | VideoFrame, texture: WebGLTexture): void {\n        this.assetToTextureMap.set(asset, texture);\n    }\n    \n    removeAssetTexture(asset: string | HTMLImageElement | VideoFrame): void {\n        const texture = this.assetToTextureMap.get(asset);\n        if (texture) {\n            this.releaseTexture(texture);\n            this.assetToTextureMap.delete(asset);\n        }\n    }\n    \n    // Video frame upload methods\n    uploadVideoFrame(frame: VideoFrame, targetTexture?: WebGLTexture): WebGLTexture {\n        const gl = this.gl;\n        const texture = targetTexture || this.getTexture();\n        \n        if (!texture) {\n            throw new Error('Failed to get texture for video frame upload');\n        }\n        \n        gl.bindTexture(gl.TEXTURE_2D, texture);\n        \n        // WebGL2 supports direct VideoFrame upload\n        gl.texImage2D(\n            gl.TEXTURE_2D,\n            0,\n            gl.RGBA,\n            gl.RGBA,\n            gl.UNSIGNED_BYTE,\n            frame\n        );\n        \n        gl.bindTexture(gl.TEXTURE_2D, null);\n        \n        // Immediately close the VideoFrame to prevent memory leaks\n        frame.close();\n        \n        return texture;\n    }\n    \n    uploadVideoFrameOptimized(frame: VideoFrame, targetTexture?: WebGLTexture): WebGLTexture {\n        const gl = this.gl;\n        const texture = targetTexture || this.getTexture();\n        \n        if (!texture) {\n            throw new Error('Failed to get texture for video frame upload');\n        }\n        \n        gl.bindTexture(gl.TEXTURE_2D, texture);\n        \n        // Use texSubImage2D for potentially better performance on existing textures\n        // This is especially useful when updating the same texture repeatedly\n        gl.texSubImage2D(\n            gl.TEXTURE_2D,\n            0,\n            0,\n            0,\n            gl.RGBA,\n            gl.UNSIGNED_BYTE,\n            frame\n        );\n        \n        gl.bindTexture(gl.TEXTURE_2D, null);\n        \n        // Close the VideoFrame to prevent memory leaks\n        frame.close();\n        \n        return texture;\n    }\n    \n    // Image upload methods\n    uploadImage(image: HTMLImageElement, targetTexture?: WebGLTexture): WebGLTexture {\n        const gl = this.gl;\n        const texture = targetTexture || this.getTexture();\n        \n        if (!texture) {\n            throw new Error('Failed to get texture for image upload');\n        }\n        \n        gl.bindTexture(gl.TEXTURE_2D, texture);\n        gl.texImage2D(\n            gl.TEXTURE_2D,\n            0,\n            gl.RGBA,\n            gl.RGBA,\n            gl.UNSIGNED_BYTE,\n            image\n        );\n        \n        // Generate mipmaps for better image quality at different scales\n        gl.generateMipmap(gl.TEXTURE_2D);\n        \n        gl.bindTexture(gl.TEXTURE_2D, null);\n        \n        return texture;\n    }\n    \n    // Canvas upload methods\n    uploadCanvas(canvas: HTMLCanvasElement, targetTexture?: WebGLTexture): WebGLTexture {\n        const gl = this.gl;\n        const texture = targetTexture || this.getTexture();\n        \n        if (!texture) {\n            throw new Error('Failed to get texture for canvas upload');\n        }\n        \n        gl.bindTexture(gl.TEXTURE_2D, texture);\n        gl.texImage2D(\n            gl.TEXTURE_2D,\n            0,\n            gl.RGBA,\n            gl.RGBA,\n            gl.UNSIGNED_BYTE,\n            canvas\n        );\n        \n        gl.bindTexture(gl.TEXTURE_2D, null);\n        \n        return texture;\n    }\n    \n    // Video frame caching for better performance\n    cacheVideoFrame(videoId: string, frame: VideoFrame, timestamp: number): WebGLTexture {\n        const texture = this.uploadVideoFrame(frame);\n        \n        if (!this.videoFrameCache.has(videoId)) {\n            this.videoFrameCache.set(videoId, []);\n        }\n        \n        const frameInfo: VideoFrameInfo = {\n            frame: frame,\n            timestamp,\n            texture\n        };\n        \n        this.videoFrameCache.get(videoId)!.push(frameInfo);\n        \n        // Limit cache size per video to prevent memory issues\n        const cache = this.videoFrameCache.get(videoId)!;\n        if (cache.length > 10) {\n            const removed = cache.shift()!;\n            if (removed.texture) {\n                this.releaseTexture(removed.texture);\n            }\n        }\n        \n        return texture;\n    }\n    \n    getCachedVideoFrame(videoId: string, timestamp: number, tolerance: number = 0.1): WebGLTexture | null {\n        const cache = this.videoFrameCache.get(videoId);\n        if (!cache) return null;\n        \n        // Find the closest frame within tolerance\n        let closestFrame: VideoFrameInfo | null = null;\n        let closestDistance = Infinity;\n        \n        for (const frameInfo of cache) {\n            const distance = Math.abs(frameInfo.timestamp - timestamp);\n            if (distance <= tolerance && distance < closestDistance) {\n                closestFrame = frameInfo;\n                closestDistance = distance;\n            }\n        }\n        \n        return closestFrame?.texture || null;\n    }\n    \n    clearVideoFrameCache(videoId?: string): void {\n        if (videoId) {\n            const cache = this.videoFrameCache.get(videoId);\n            if (cache) {\n                cache.forEach(frameInfo => {\n                    if (frameInfo.texture) {\n                        this.releaseTexture(frameInfo.texture);\n                    }\n                });\n                this.videoFrameCache.delete(videoId);\n            }\n        } else {\n            // Clear all video frame caches\n            this.videoFrameCache.forEach(cache => {\n                cache.forEach(frameInfo => {\n                    if (frameInfo.texture) {\n                        this.releaseTexture(frameInfo.texture);\n                    }\n                });\n            });\n            this.videoFrameCache.clear();\n        }\n    }\n    \n    // Memory management\n    getMemoryUsage(): {\n        totalTextures: number;\n        usedTextures: number;\n        pooledTextures: number;\n        cachedFrames: number;\n    } {\n        return {\n            totalTextures: this.usedTextures.size + this.texturePool.length,\n            usedTextures: this.usedTextures.size,\n            pooledTextures: this.texturePool.length,\n            cachedFrames: Array.from(this.videoFrameCache.values())\n                .reduce((total, cache) => total + cache.length, 0)\n        };\n    }\n    \n    setDefaultTextureSize(width: number, height: number): void {\n        this.defaultTextureWidth = width;\n        this.defaultTextureHeight = height;\n    }\n    \n    // Cleanup\n    dispose(): void {\n        const gl = this.gl;\n        \n        // Delete all textures in the pool\n        this.texturePool.forEach(texture => gl.deleteTexture(texture));\n        this.texturePool = [];\n        \n        // Delete all used textures\n        this.usedTextures.forEach(texture => gl.deleteTexture(texture));\n        this.usedTextures.clear();\n        \n        // Clear all mappings and caches\n        this.assetToTextureMap.clear();\n        this.videoFrameCache.clear();\n    }\n}", "export const PASSTHROUGH_VERTEX_SHADER = `#version 300 es\nprecision highp float;\n\n// Input attributes\nin vec2 a_position;\nin vec2 a_texCoord;\n\n// Output varyings to fragment shader\nout vec2 v_texCoord;\n\nvoid main() {\n    // Pass through position (clip space coordinates)\n    gl_Position = vec4(a_position, 0.0, 1.0);\n    \n    // Pass through texture coordinates\n    // Note: Y-axis is flipped to handle WebGL's inverted texture coordinates\n    v_texCoord = a_texCoord;\n}\n`;\n\nexport const VIGNETTE_FRAGMENT_SHADER = `#version 300 es\nprecision highp float;\n\n// Input from vertex shader\nin vec2 v_texCoord;\n\n// Uniforms\nuniform sampler2D u_sourceTexture;\nuniform float u_intensity; // Vignette intensity (0.0 to 1.0)\nuniform float u_radius;    // Vignette radius (0.0 to 2.0)\n\n// Output color\nout vec4 fragColor;\n\nvoid main() {\n    // Sample the source texture\n    vec4 color = texture(u_sourceTexture, v_texCoord);\n    \n    // Calculate distance from center (0.5, 0.5)\n    vec2 center = vec2(0.5);\n    float dist = distance(v_texCoord, center);\n    \n    // Create vignette effect\n    float vignette = 1.0 - smoothstep(u_radius, u_radius + 0.5, dist);\n    vignette = mix(vignette, 1.0, 1.0 - u_intensity);\n    \n    // Apply vignette to color\n    fragColor = vec4(color.rgb * vignette, color.a);\n}\n`;\n\nexport const SATURATION_FRAGMENT_SHADER = `#version 300 es\nprecision highp float;\n\n// Input from vertex shader\nin vec2 v_texCoord;\n\n// Uniforms\nuniform sampler2D u_sourceTexture;\nuniform float u_saturation; // Saturation level (0.0 = grayscale, 1.0 = normal, >1.0 = oversaturated)\n\n// Output color\nout vec4 fragColor;\n\nvoid main() {\n    // Sample the source texture\n    vec4 color = texture(u_sourceTexture, v_texCoord);\n    \n    // Calculate grayscale using standard luminance weights\n    float gray = dot(color.rgb, vec3(0.299, 0.587, 0.114));\n    \n    // Mix between grayscale and original color based on saturation\n    vec3 finalColor = mix(vec3(gray), color.rgb, u_saturation);\n    \n    // Output the final color with original alpha\n    fragColor = vec4(finalColor, color.a);\n}\n`;\n\nexport const LUT_FRAGMENT_SHADER = `#version 300 es\nprecision highp float;\n\n// Input from vertex shader\nin vec2 v_texCoord;\n\n// Uniforms\nuniform sampler2D u_sourceTexture;\nuniform sampler3D u_lutTexture; // 3D LUT texture\nuniform float u_intensity;       // LUT intensity (0.0 to 1.0)\n\n// Output color\nout vec4 fragColor;\n\nvoid main() {\n    // Sample the source texture\n    vec4 color = texture(u_sourceTexture, v_texCoord);\n    \n    // Sample LUT using color as coordinates\n    vec3 lutColor = texture(u_lutTexture, color.rgb).rgb;\n    \n    // Mix original color with LUT color\n    vec3 finalColor = mix(color.rgb, lutColor, u_intensity);\n    \n    // Output the final color with original alpha\n    fragColor = vec4(finalColor, color.a);\n}\n`;\n\nexport const PASSTHROUGH_FRAGMENT_SHADER = `#version 300 es\nprecision highp float;\n\n// Input from vertex shader\nin vec2 v_texCoord;\n\n// Uniforms\nuniform sampler2D u_sourceTexture;\nuniform float u_opacity; // Optional opacity control\nuniform vec2 u_resolution; // Optional resolution for effects\n\n// Output color\nout vec4 fragColor;\n\nvoid main() {\n    // Sample the source texture\n    vec4 color = texture(u_sourceTexture, v_texCoord);\n    \n    // Apply opacity if provided\n    color.a *= u_opacity;\n    \n    // Output the final color\n    fragColor = color;\n}\n`;\n\nexport const GRAYSCALE_FRAGMENT_SHADER = `#version 300 es\nprecision highp float;\n\n// Input from vertex shader\nin vec2 v_texCoord;\n\n// Uniforms\nuniform sampler2D u_sourceTexture;\nuniform float u_strength; // 0.0 = original, 1.0 = full grayscale\n\n// Output color\nout vec4 fragColor;\n\nvoid main() {\n    // Sample the source texture\n    vec4 color = texture(u_sourceTexture, v_texCoord);\n    \n    // Calculate grayscale using standard luminance weights\n    float gray = dot(color.rgb, vec3(0.299, 0.587, 0.114));\n    \n    // Mix between original color and grayscale\n    vec3 finalColor = mix(color.rgb, vec3(gray), u_strength);\n    \n    // Output the final color with original alpha\n    fragColor = vec4(finalColor, color.a);\n}\n`;\n\nexport const BLUR_FRAGMENT_SHADER = `#version 300 es\nprecision highp float;\n\n// Input from vertex shader\nin vec2 v_texCoord;\n\n// Uniforms\nuniform sampler2D u_sourceTexture;\nuniform float u_radius; // Blur radius in pixels\nuniform vec2 u_resolution; // Texture resolution for pixel-perfect blur\nuniform int u_direction; // 0 = horizontal, 1 = vertical, 2 = both (separable blur)\n\n// Output color\nout vec4 fragColor;\n\nvoid main() {\n    vec2 texelSize = 1.0 / u_resolution;\n    vec4 color = vec4(0.0);\n    \n    if (u_direction == 0 || u_direction == 2) {\n        // Horizontal blur\n        for (int x = -5; x <= 5; x++) {\n            float weight = exp(-0.5 * pow(float(x) / max(u_radius, 0.1), 2.0));\n            vec2 offset = vec2(float(x) * texelSize.x, 0.0);\n            color += texture(u_sourceTexture, v_texCoord + offset) * weight;\n        }\n    } else if (u_direction == 1) {\n        // Vertical blur\n        for (int y = -5; y <= 5; y++) {\n            float weight = exp(-0.5 * pow(float(y) / max(u_radius, 0.1), 2.0));\n            vec2 offset = vec2(0.0, float(y) * texelSize.y);\n            color += texture(u_sourceTexture, v_texCoord + offset) * weight;\n        }\n    }\n    \n    // Normalize weights\n    float totalWeight = 0.0;\n    for (int i = -5; i <= 5; i++) {\n        totalWeight += exp(-0.5 * pow(float(i) / max(u_radius, 0.1), 2.0));\n    }\n    \n    fragColor = color / totalWeight;\n}\n`;\n\nexport const BRIGHTNESS_FRAGMENT_SHADER = `#version 300 es\nprecision highp float;\n\n// Input from vertex shader\nin vec2 v_texCoord;\n\n// Uniforms\nuniform sampler2D u_sourceTexture;\nuniform float u_brightness; // -1.0 to 1.0\nuniform float u_contrast;   // 0.0 to 2.0\n\n// Output color\nout vec4 fragColor;\n\nvoid main() {\n    // Sample the source texture\n    vec4 color = texture(u_sourceTexture, v_texCoord);\n    \n    // Apply brightness\n    vec3 rgb = color.rgb + u_brightness;\n    \n    // Apply contrast\n    rgb = (rgb - vec3(0.5)) * u_contrast + vec3(0.5);\n    \n    // Clamp values to valid range\n    rgb = clamp(rgb, 0.0, 1.0);\n    \n    // Output the final color\n    fragColor = vec4(rgb, color.a);\n}\n`;\n\nexport const TINT_FRAGMENT_SHADER = `#version 300 es\nprecision highp float;\n\n// Input from vertex shader\nin vec2 v_texCoord;\n\n// Uniforms\nuniform sampler2D u_sourceTexture;\nuniform vec3 u_tintColor; // RGB tint color\nuniform float u_tintStrength; // 0.0 = no tint, 1.0 = full tint\n\n// Output color\nout vec4 fragColor;\n\nvoid main() {\n    // Sample the source texture\n    vec4 color = texture(u_sourceTexture, v_texCoord);\n    \n    // Apply tint by mixing with the tint color\n    vec3 finalColor = mix(color.rgb, color.rgb * u_tintColor, u_tintStrength);\n    \n    // Output the final color\n    fragColor = vec4(finalColor, color.a);\n}\n`;\n\nexport const CHROMA_KEY_FRAGMENT_SHADER = `#version 300 es\nprecision highp float;\n\n// Input from vertex shader\nin vec2 v_texCoord;\n\n// Uniforms\nuniform sampler2D u_sourceTexture;\nuniform vec3 u_keyColor;     // Color to make transparent\nuniform float u_threshold;   // Color similarity threshold (0.0 - 1.0)\nuniform float u_softness;    // Edge softness (0.0 = hard edge, 1.0 = soft edge)\nuniform float u_spillReduction; // How much to reduce color spill (0.0 - 1.0)\n\n// Output color\nout vec4 fragColor;\n\nvoid main() {\n    // Sample the source texture\n    vec4 color = texture(u_sourceTexture, v_texCoord);\n    \n    // Calculate color difference from key color\n    vec3 colorDiff = abs(color.rgb - u_keyColor);\n    float maxDiff = max(max(colorDiff.r, colorDiff.g), colorDiff.b);\n    \n    // Create alpha based on color similarity\n    float alpha = smoothstep(u_threshold - u_softness, u_threshold + u_softness, maxDiff);\n    \n    // Reduce color spill by desaturating areas near the key color\n    float spillAmount = 1.0 - smoothstep(u_threshold, u_threshold + u_softness, maxDiff);\n    vec3 desaturatedColor = vec3(dot(color.rgb, vec3(0.299, 0.587, 0.114)));\n    vec3 finalColor = mix(color.rgb, desaturatedColor, spillAmount * u_spillReduction);\n    \n    // Output the final color with calculated alpha\n    fragColor = vec4(finalColor, alpha * color.a);\n}\n`;", "import { TiramisuRenderer } from './TiramisuRenderer.js';\nimport { Effect, ShaderUniform } from '../types.js';\nimport {\n    PASSTHROUGH_VERTEX_SHADER,\n    PASSTHROUGH_FRAGMENT_SHADER,\n    GRAYSCALE_FRAGMENT_SHADER,\n    BLUR_FRAGMENT_SHADER,\n    BRIGHTNESS_FRAGMENT_SHADER,\n    TINT_FRAGMENT_SHADER,\n    CHROMA_KEY_FRAGMENT_SHADER,\n    VIGNETTE_FRAGMENT_SHADER,\n    SATURATION_FRAGMENT_SHADER,\n    LUT_FRAGMENT_SHADER\n} from './shaders/ShaderLibrary.js';\n\nexport class ShaderManager {\n    private renderer: TiramisuRenderer;\n    private loadedShaders: Set<string> = new Set();\n    \n    constructor(renderer: TiramisuRenderer) {\n        this.renderer = renderer;\n        this.initializeDefaultShaders();\n    }\n    \n    private initializeDefaultShaders(): void {\n        // Load all default shaders\n        this.loadShader('passthrough', PASSTHROUGH_VERTEX_SHADER, PASSTHROUGH_FRAGMENT_SHADER);\n        this.loadShader('grayscale', PASSTHROUGH_VERTEX_SHADER, GRAYSCALE_FRAGMENT_SHADER);\n        this.loadShader('blur', PASSTHROUGH_VERTEX_SHADER, BLUR_FRAGMENT_SHADER);\n        this.loadShader('brightness', PASSTHROUGH_VERTEX_SHADER, BRIGHTNESS_FRAGMENT_SHADER);\n        this.loadShader('tint', PASSTHROUGH_VERTEX_SHADER, TINT_FRAGMENT_SHADER);\n        this.loadShader('chromakey', PASSTHROUGH_VERTEX_SHADER, CHROMA_KEY_FRAGMENT_SHADER);\n        this.loadShader('vignette', PASSTHROUGH_VERTEX_SHADER, VIGNETTE_FRAGMENT_SHADER);\n        this.loadShader('saturation', PASSTHROUGH_VERTEX_SHADER, SATURATION_FRAGMENT_SHADER);\n        this.loadShader('lut', PASSTHROUGH_VERTEX_SHADER, LUT_FRAGMENT_SHADER);\n    }\n    \n    loadShader(id: string, vertexShader: string, fragmentShader: string): void {\n        try {\n            this.renderer.createShaderProgram(id, vertexShader, fragmentShader);\n            this.loadedShaders.add(id);\n        } catch (error) {\n            console.error(`Failed to load shader '${id}':`, error);\n            throw error;\n        }\n    }\n    \n    isShaderLoaded(id: string): boolean {\n        return this.loadedShaders.has(id);\n    }\n    \n    getLoadedShaders(): string[] {\n        return Array.from(this.loadedShaders);\n    }\n    \n    // Convenience methods for creating common effects\n    createGrayscaleEffect(strength: number = 1.0): Effect {\n        return {\n            id: `grayscale_${Date.now()}`,\n            shaderId: 'grayscale',\n            uniforms: {\n                u_strength: strength\n            },\n            enabled: true\n        };\n    }\n    \n    createBlurEffect(radius: number, resolution: { width: number; height: number }, direction: 'horizontal' | 'vertical' | 'both' = 'both'): Effect {\n        const directionMap = { horizontal: 0, vertical: 1, both: 2 };\n        \n        return {\n            id: `blur_${Date.now()}`,\n            shaderId: 'blur',\n            uniforms: {\n                u_radius: radius,\n                u_resolution: [resolution.width, resolution.height],\n                u_direction: directionMap[direction]\n            },\n            enabled: true\n        };\n    }\n    \n    createBrightnessEffect(brightness: number, contrast: number = 1.0): Effect {\n        return {\n            id: `brightness_${Date.now()}`,\n            shaderId: 'brightness',\n            uniforms: {\n                u_brightness: brightness,\n                u_contrast: contrast\n            },\n            enabled: true\n        };\n    }\n    \n    createTintEffect(color: { r: number; g: number; b: number }, strength: number = 1.0): Effect {\n        return {\n            id: `tint_${Date.now()}`,\n            shaderId: 'tint',\n            uniforms: {\n                u_tintColor: [color.r, color.g, color.b],\n                u_tintStrength: strength\n            },\n            enabled: true\n        };\n    }\n    \n    createChromaKeyEffect(\n        keyColor: { r: number; g: number; b: number },\n        threshold: number = 0.3,\n        softness: number = 0.1,\n        spillReduction: number = 0.5\n    ): Effect {\n        return {\n            id: `chromakey_${Date.now()}`,\n            shaderId: 'chromakey',\n            uniforms: {\n                u_keyColor: [keyColor.r, keyColor.g, keyColor.b],\n                u_threshold: threshold,\n                u_softness: softness,\n                u_spillReduction: spillReduction\n            },\n            enabled: true\n        };\n    }\n    \n    // Create custom effect with any shader\n    createCustomEffect(shaderId: string, uniforms: Record<string, ShaderUniform>): Effect {\n        if (!this.isShaderLoaded(shaderId)) {\n            throw new Error(`Shader '${shaderId}' is not loaded`);\n        }\n        \n        return {\n            id: `custom_${shaderId}_${Date.now()}`,\n            shaderId,\n            uniforms,\n            enabled: true\n        };\n    }\n    \n    // Create effect chain (multiple effects applied in sequence)\n    createEffectChain(effects: Effect[]): Effect[] {\n        return effects.map((effect, index) => ({\n            ...effect,\n            id: effect.id || `chain_${index}_${Date.now()}`\n        }));\n    }\n    \n    // Preset effect combinations\n    createVintageEffect(): Effect[] {\n        return [\n            this.createBrightnessEffect(-0.1, 1.1),\n            this.createTintEffect({ r: 1.0, g: 0.9, b: 0.7 }, 0.3),\n            this.createBlurEffect(0.5, { width: 1920, height: 1080 }, 'both')\n        ];\n    }\n    \n    createCinematicEffect(): Effect[] {\n        return [\n            this.createBrightnessEffect(-0.05, 1.2),\n            this.createTintEffect({ r: 0.9, g: 0.95, b: 1.0 }, 0.2)\n        ];\n    }\n    \n    createBlackAndWhiteEffect(): Effect[] {\n        return [\n            this.createGrayscaleEffect(1.0),\n            this.createBrightnessEffect(0.1, 1.1)\n        ];\n    }\n    \n    // Utility method to update effect uniforms\n    updateEffectUniform(effect: Effect, uniformName: string, value: ShaderUniform): void {\n        effect.uniforms[uniformName] = value;\n    }\n    \n    // Convenience methods for additional effects\n    createVignetteEffect(intensity: number = 0.5, radius: number = 0.8): Effect {\n        return {\n            id: `vignette_${Date.now()}`,\n            shaderId: 'vignette',\n            uniforms: {\n                u_intensity: intensity,\n                u_radius: radius\n            },\n            enabled: true\n        };\n    }\n    \n    createSaturationEffect(saturation: number): Effect {\n        return {\n            id: `saturation_${Date.now()}`,\n            shaderId: 'saturation',\n            uniforms: {\n                u_saturation: saturation\n            },\n            enabled: true\n        };\n    }\n    \n    createLUTEffect(lutTexture: WebGLTexture, intensity: number = 1.0): Effect {\n        return {\n            id: `lut_${Date.now()}`,\n            shaderId: 'lut',\n            uniforms: {\n                u_lutTexture: lutTexture,\n                u_intensity: intensity\n            },\n            enabled: true\n        };\n    }\n    \n    // Utility method to toggle effect on/off\n    toggleEffect(effect: Effect): void {\n        effect.enabled = !effect.enabled;\n    }\n    \n    dispose(): void {\n        this.loadedShaders.clear();\n    }\n}", "import { GOPManager, WebCodecsConfig, VideoFrameInfo, ITextureManager } from '../types.js';\n\ninterface MP4Box {\n    createFile: () => MP4File;\n    setLogLevel: (level: number) => void;\n}\n\ninterface MP4File {\n    flush: () => void;\n    appendBuffer: (buffer: ArrayBuffer) => void;\n    seek: (time: number, onSuccess: () => void) => void;\n    getSample: (sampleId: number) => any;\n    release: () => void;\n}\n\ndeclare global {\n    const MP4Box: MP4Box;\n}\n\ninterface VideoSourceData {\n    url: string;\n    config: WebCodecsConfig;\n    mp4BoxFile: MP4File | null;\n    videoDecoder: VideoDecoder | null;\n    gopManager: GOPManagerImpl;\n    duration: number;\n    timescale: number;\n    frameRate: number;\n    totalFrames: number;\n    decodedFrames: Map<number, VideoFrame>;\n    currentFrameIndex: number;\n    keyframes: number[];\n    isInitialized: boolean;\n    isDecoding: boolean;\n}\n\nexport class WebCodecsVideoSource {\n    private videoSources: Map<string, VideoSourceData> = new Map();\n    \n    // Event handlers\n    private onFrameDecoded: ((sourceId: string, frame: VideoFrame, index: number) => void) | null = null;\n    private onSeekComplete: ((sourceId: string) => void) | null = null;\n    private onError: ((sourceId: string, error: Error) => void) | null = null;\n    \n    constructor() {\n        // Set MP4Box log level to reduce console spam\n        if (typeof MP4Box !== 'undefined') {\n            MP4Box.setLogLevel(0);\n        }\n    }\n    \n    async loadVideo(sourceId: string, videoUrl: string, config: Partial<WebCodecsConfig> = {}): Promise<void> {\n        const defaultConfig: WebCodecsConfig = {\n            codec: 'avc1.64001F', // H.264 High Profile Level 4.0\n            width: 1920,\n            height: 1080,\n            bitrate: 10000000, // 10 Mbps\n            framerate: 30\n        };\n        \n        const finalConfig = { ...defaultConfig, ...config };\n        \n        const sourceData: VideoSourceData = {\n            url: videoUrl,\n            config: finalConfig,\n            mp4BoxFile: null,\n            videoDecoder: null,\n            gopManager: new GOPManagerImpl(),\n            duration: 0,\n            timescale: 0,\n            frameRate: finalConfig.framerate || 30,\n            totalFrames: 0,\n            decodedFrames: new Map(),\n            currentFrameIndex: 0,\n            keyframes: [],\n            isInitialized: false,\n            isDecoding: false\n        };\n        \n        this.videoSources.set(sourceId, sourceData);\n        await this.initializeSource(sourceId);\n    }\n    \n    private async initializeSource(sourceId: string): Promise<void> {\n        const sourceData = this.videoSources.get(sourceId);\n        if (!sourceData) throw new Error(`Source ${sourceId} not found`);\n        \n        try {\n            // Load MP4 file\n            const response = await fetch(sourceData.url);\n            const arrayBuffer = await response.arrayBuffer();\n            \n            // Initialize MP4Box for demuxing\n            if (typeof MP4Box === 'undefined') {\n                throw new Error('MP4Box library not loaded. Please include mp4box.js');\n            }\n            \n            sourceData.mp4BoxFile = MP4Box.createFile();\n            this.setupMP4BoxHandlers(sourceId);\n            \n            // Parse file\n            sourceData.mp4BoxFile.appendBuffer(arrayBuffer);\n            sourceData.mp4BoxFile.flush();\n            \n            // Initialize video decoder\n            this.initializeDecoder(sourceId);\n            \n            // Extract keyframe information\n            await this.extractKeyframeInfo(sourceId);\n            \n            sourceData.isInitialized = true;\n        } catch (error) {\n            this.handleError(sourceId, error as Error);\n            throw error;\n        }\n    }\n    \n    private setupMP4BoxHandlers(sourceId: string): void {\n        const sourceData = this.videoSources.get(sourceId);\n        if (!sourceData?.mp4BoxFile) return;\n        \n        (sourceData.mp4BoxFile as any).onReady = (info: any) => {\n            console.log(`MP4 file ready for ${sourceId}:`, info);\n            sourceData.duration = info.duration / info.timescale;\n            sourceData.timescale = info.timescale;\n            sourceData.totalFrames = Math.floor(sourceData.duration * sourceData.frameRate);\n        };\n        \n        (sourceData.mp4BoxFile as any).onSamples = (trackId: number, user: any, samples: any[]) => {\n            samples.forEach(sample => {\n                const chunk = new EncodedVideoChunk({\n                    type: sample.is_sync ? 'key' : 'delta',\n                    timestamp: sample.cts * 1000000 / sourceData.timescale,\n                    data: sample.data\n                });\n                \n                sourceData.videoDecoder?.decode(chunk);\n            });\n        };\n    }\n    \n    private initializeDecoder(sourceId: string): void {\n        const sourceData = this.videoSources.get(sourceId);\n        if (!sourceData) return;\n        \n        sourceData.videoDecoder = new VideoDecoder({\n            output: (frame: VideoFrame) => {\n                this.handleDecodedFrame(sourceId, frame);\n            },\n            error: (error: Error) => {\n                this.handleError(sourceId, error);\n            }\n        });\n        \n        sourceData.videoDecoder.configure(sourceData.config);\n    }\n    \n    private handleDecodedFrame(sourceId: string, frame: VideoFrame): void {\n        const sourceData = this.videoSources.get(sourceId);\n        if (!sourceData) return;\n        \n        sourceData.decodedFrames.set(sourceData.currentFrameIndex++, frame);\n        \n        if (this.onFrameDecoded) {\n            this.onFrameDecoded(sourceId, frame, sourceData.currentFrameIndex - 1);\n        }\n        \n        this.cleanupOldFrames(sourceId);\n    }\n    \n    private cleanupOldFrames(sourceId: string, maxFramesToKeep: number = 30): void {\n        const sourceData = this.videoSources.get(sourceId);\n        if (!sourceData) return;\n        \n        if (sourceData.decodedFrames.size <= maxFramesToKeep) return;\n        \n        const framesToRemove: number[] = [];\n        const targetFrame = Math.max(0, sourceData.currentFrameIndex - maxFramesToKeep);\n        \n        sourceData.decodedFrames.forEach((frame, index) => {\n            if (index < targetFrame) {\n                framesToRemove.push(index);\n            }\n        });\n        \n        framesToRemove.forEach(index => {\n            const frame = sourceData.decodedFrames.get(index);\n            if (frame) {\n                frame.close();\n                sourceData.decodedFrames.delete(index);\n            }\n        });\n    }\n    \n    private async extractKeyframeInfo(sourceId: string): Promise<void> {\n        const sourceData = this.videoSources.get(sourceId);\n        if (!sourceData) return;\n        \n        const estimatedKeyframeInterval = Math.floor(sourceData.frameRate);\n        \n        for (let i = 0; i < sourceData.totalFrames; i += estimatedKeyframeInterval) {\n            sourceData.keyframes.push(i);\n        }\n        \n        if (sourceData.keyframes.length === 0 || sourceData.keyframes[0] !== 0) {\n            sourceData.keyframes.unshift(0);\n        }\n        \n        sourceData.gopManager.setKeyframes(sourceData.keyframes);\n    }\n    \n    async seekToFrame(sourceId: string, frameNumber: number): Promise<void> {\n        const sourceData = this.videoSources.get(sourceId);\n        if (!sourceData?.isInitialized) {\n            throw new Error(`Video source ${sourceId} not initialized`);\n        }\n        \n        frameNumber = Math.max(0, Math.min(frameNumber, sourceData.totalFrames - 1));\n        \n        const nearestKeyframe = this.findNearestKeyframe(sourceId, frameNumber);\n        \n        this.clearDecodedFrames(sourceId);\n        \n        await this.seekToTime(sourceId, nearestKeyframe / sourceData.frameRate);\n        \n        sourceData.currentFrameIndex = nearestKeyframe;\n        await this.decodeFramesToTarget(sourceId, nearestKeyframe, frameNumber);\n        \n        if (this.onSeekComplete) {\n            this.onSeekComplete(sourceId);\n        }\n    }\n    \n    private findNearestKeyframe(sourceId: string, frameNumber: number): number {\n        const sourceData = this.videoSources.get(sourceId);\n        if (!sourceData) return 0;\n        \n        for (let i = sourceData.keyframes.length - 1; i >= 0; i--) {\n            if (sourceData.keyframes[i] <= frameNumber) {\n                return sourceData.keyframes[i];\n            }\n        }\n        return 0;\n    }\n    \n    private async seekToTime(sourceId: string, timeInSeconds: number): Promise<void> {\n        const sourceData = this.videoSources.get(sourceId);\n        if (!sourceData?.mp4BoxFile) return;\n        \n        return new Promise<void>((resolve) => {\n            const originalOnSeek = (sourceData.mp4BoxFile as any).onSeek;\n            \n            (sourceData.mp4BoxFile as any).onSeek = () => {\n                originalOnSeek?.();\n                resolve();\n            };\n            \n            sourceData.mp4BoxFile!.seek(timeInSeconds * sourceData.timescale, () => {\n                sourceData.mp4BoxFile!.flush();\n            });\n        });\n    }\n    \n    private async decodeFramesToTarget(sourceId: string, startFrame: number, targetFrame: number): Promise<void> {\n        const sourceData = this.videoSources.get(sourceId);\n        if (!sourceData) return;\n        \n        return new Promise<void>((resolve) => {\n            const originalOnFrameDecoded = this.onFrameDecoded;\n            let framesDecoded = 0;\n            const framesToDecode = targetFrame - startFrame + 1;\n            \n            this.onFrameDecoded = (srcId: string, frame: VideoFrame, index: number) => {\n                if (srcId !== sourceId) return;\n                \n                framesDecoded++;\n                \n                if (originalOnFrameDecoded) {\n                    originalOnFrameDecoded(srcId, frame, index);\n                }\n                \n                if (framesDecoded >= framesToDecode) {\n                    this.onFrameDecoded = originalOnFrameDecoded;\n                    resolve();\n                }\n            };\n            \n            sourceData.mp4BoxFile!.flush();\n        });\n    }\n    \n    async getFrameTexture(sourceId: string, frameNumber: number, textureManager: ITextureManager): Promise<WebGLTexture | null> {\n        const sourceData = this.videoSources.get(sourceId);\n        if (!sourceData) return null;\n        \n        let frame = sourceData.decodedFrames.get(frameNumber);\n        \n        if (!frame) {\n            // Try to seek to the frame if not already decoded\n            try {\n                await this.seekToFrame(sourceId, frameNumber);\n                frame = sourceData.decodedFrames.get(frameNumber);\n            } catch (error) {\n                console.error(`Failed to seek to frame ${frameNumber} for source ${sourceId}:`, error);\n                return null;\n            }\n        }\n        \n        if (!frame) return null;\n        \n        // Upload the frame as a texture\n        return textureManager.uploadVideoFrame(frame);\n    }\n    \n    getCurrentFrame(sourceId: string): VideoFrame | null {\n        const sourceData = this.videoSources.get(sourceId);\n        if (!sourceData) return null;\n        \n        return sourceData.decodedFrames.get(sourceData.currentFrameIndex) || null;\n    }\n    \n    getFrame(sourceId: string, frameNumber: number): VideoFrame | null {\n        const sourceData = this.videoSources.get(sourceId);\n        if (!sourceData) return null;\n        \n        return sourceData.decodedFrames.get(frameNumber) || null;\n    }\n    \n    getDuration(sourceId: string): number {\n        const sourceData = this.videoSources.get(sourceId);\n        return sourceData?.duration || 0;\n    }\n    \n    getTotalFrames(sourceId: string): number {\n        const sourceData = this.videoSources.get(sourceId);\n        return sourceData?.totalFrames || 0;\n    }\n    \n    getFrameRate(sourceId: string): number {\n        const sourceData = this.videoSources.get(sourceId);\n        return sourceData?.frameRate || 30;\n    }\n    \n    getKeyframes(sourceId: string): number[] {\n        const sourceData = this.videoSources.get(sourceId);\n        return sourceData ? [...sourceData.keyframes] : [];\n    }\n    \n    isReady(sourceId: string): boolean {\n        const sourceData = this.videoSources.get(sourceId);\n        return sourceData?.isInitialized && sourceData.videoDecoder?.state === 'configured' || false;\n    }\n    \n    // Event setter methods\n    on(event: 'frameDecoded', callback: (sourceId: string, frame: VideoFrame, index: number) => void): void;\n    on(event: 'seekComplete', callback: (sourceId: string) => void): void;\n    on(event: 'error', callback: (sourceId: string, error: Error) => void): void;\n    on(event: string, callback: any): void {\n        switch (event) {\n            case 'frameDecoded':\n                this.onFrameDecoded = callback;\n                break;\n            case 'seekComplete':\n                this.onSeekComplete = callback;\n                break;\n            case 'error':\n                this.onError = callback;\n                break;\n        }\n    }\n    \n    off(event: string): void {\n        switch (event) {\n            case 'frameDecoded':\n                this.onFrameDecoded = null;\n                break;\n            case 'seekComplete':\n                this.onSeekComplete = null;\n                break;\n            case 'error':\n                this.onError = null;\n                break;\n        }\n    }\n    \n    private handleError(sourceId: string, error: Error): void {\n        console.error(`WebCodecsVideoSource error for ${sourceId}:`, error);\n        if (this.onError) {\n            this.onError(sourceId, error);\n        }\n    }\n    \n    private clearDecodedFrames(sourceId: string): void {\n        const sourceData = this.videoSources.get(sourceId);\n        if (!sourceData) return;\n        \n        sourceData.decodedFrames.forEach(frame => frame.close());\n        sourceData.decodedFrames.clear();\n    }\n    \n    dispose(): void {\n        this.videoSources.forEach((sourceData, sourceId) => {\n            if (sourceData.videoDecoder) {\n                sourceData.videoDecoder.close();\n            }\n            \n            this.clearDecodedFrames(sourceId);\n            \n            if (sourceData.mp4BoxFile) {\n                sourceData.mp4BoxFile.release();\n            }\n        });\n        \n        this.videoSources.clear();\n        \n        this.onFrameDecoded = null;\n        this.onSeekComplete = null;\n        this.onError = null;\n    }\n}\n\n// GOP Manager implementation\nclass GOPManagerImpl implements GOPManager {\n    public keyframes: number[] = [];\n    private currentFrame: VideoFrame | null = null;\n    \n    setKeyframes(keyframes: number[]): void {\n        this.keyframes = [...keyframes].sort((a, b) => a - b);\n    }\n    \n    async seekToFrame(frameNumber: number): Promise<void> {\n        const nearestKeyframe = this.findNearestKeyframe(frameNumber);\n        console.log(`Seeking to frame ${frameNumber} via keyframe ${nearestKeyframe}`);\n    }\n    \n    getCurrentFrame(): VideoFrame | null {\n        return this.currentFrame;\n    }\n    \n    setCurrentFrame(frame: VideoFrame): void {\n        if (this.currentFrame) {\n            this.currentFrame.close();\n        }\n        this.currentFrame = frame;\n    }\n    \n    findNearestKeyframe(frameNumber: number): number {\n        for (let i = this.keyframes.length - 1; i >= 0; i--) {\n            if (this.keyframes[i] <= frameNumber) {\n                return this.keyframes[i];\n            }\n        }\n        return 0;\n    }\n    \n    getKeyframeInterval(frameNumber: number): number {\n        const currentKeyframe = this.findNearestKeyframe(frameNumber);\n        const nextKeyframeIndex = this.keyframes.findIndex(kf => kf === currentKeyframe) + 1;\n        const nextKeyframe = this.keyframes[nextKeyframeIndex];\n        \n        return nextKeyframe ? nextKeyframe - currentKeyframe : this.keyframes[this.keyframes.length - 1] - currentKeyframe;\n    }\n    \n    dispose(): void {\n        if (this.currentFrame) {\n            this.currentFrame.close();\n            this.currentFrame = null;\n        }\n        this.keyframes = [];\n    }\n}", "import { Effect, ShaderUniform } from '../types.js';\n\nexport class EffectStack {\n    private effects: Effect[] = [];\n    private enabled: boolean = true;\n    \n    addEffect(effect: Effect): void {\n        this.effects.push(effect);\n    }\n    \n    removeEffect(effectId: string): boolean {\n        const index = this.effects.findIndex(effect => effect.id === effectId);\n        if (index !== -1) {\n            this.effects.splice(index, 1);\n            return true;\n        }\n        return false;\n    }\n    \n    getEffect(effectId: string): Effect | undefined {\n        return this.effects.find(effect => effect.id === effectId);\n    }\n    \n    updateEffect(effectId: string, uniforms: Record<string, ShaderUniform>): boolean {\n        const effect = this.getEffect(effectId);\n        if (effect) {\n            Object.assign(effect.uniforms, uniforms);\n            return true;\n        }\n        return false;\n    }\n    \n    toggleEffect(effectId: string): boolean {\n        const effect = this.getEffect(effectId);\n        if (effect) {\n            effect.enabled = !effect.enabled;\n            return true;\n        }\n        return false;\n    }\n    \n    setEffectEnabled(effectId: string, enabled: boolean): boolean {\n        const effect = this.getEffect(effectId);\n        if (effect) {\n            effect.enabled = enabled;\n            return true;\n        }\n        return false;\n    }\n    \n    getActiveEffects(): Effect[] {\n        if (!this.enabled) return [];\n        return this.effects.filter(effect => effect.enabled);\n    }\n    \n    getAllEffects(): Effect[] {\n        return [...this.effects];\n    }\n    \n    clearEffects(): void {\n        this.effects = [];\n    }\n    \n    setEnabled(enabled: boolean): void {\n        this.enabled = enabled;\n    }\n    \n    isEnabled(): boolean {\n        return this.enabled;\n    }\n    \n    // Reorder effects (change rendering order)\n    moveEffect(effectId: string, newIndex: number): boolean {\n        const index = this.effects.findIndex(effect => effect.id === effectId);\n        if (index === -1) return false;\n        \n        if (newIndex < 0 || newIndex >= this.effects.length) return false;\n        \n        const [effect] = this.effects.splice(index, 1);\n        this.effects.splice(newIndex, 0, effect);\n        \n        return true;\n    }\n    \n    // Duplicate an effect\n    duplicateEffect(effectId: string): string | null {\n        const effect = this.getEffect(effectId);\n        if (!effect) return null;\n        \n        const duplicatedEffect: Effect = {\n            ...effect,\n            id: `${effect.id}_copy_${Date.now()}`,\n            uniforms: { ...effect.uniforms }\n        };\n        \n        this.addEffect(duplicatedEffect);\n        return duplicatedEffect.id;\n    }\n    \n    // Get effect chain as array (for rendering)\n    getEffectChain(): Effect[] {\n        return this.getActiveEffects();\n    }\n}\n\nexport class ClipEffectStack extends EffectStack {\n    private clipId: string;\n    \n    constructor(clipId: string) {\n        super();\n        this.clipId = clipId;\n    }\n    \n    getClipId(): string {\n        return this.clipId;\n    }\n}\n\nexport class AdjustmentLayerStack extends EffectStack {\n    private trackId: string;\n    private affectsBelow: boolean = true;\n    \n    constructor(trackId: string, affectsBelow: boolean = true) {\n        super();\n        this.trackId = trackId;\n        this.affectsBelow = affectsBelow;\n    }\n    \n    getTrackId(): string {\n        return this.trackId;\n    }\n    \n    affectsTracksBelow(): boolean {\n        return this.affectsBelow;\n    }\n    \n    setAffectsBelow(affectsBelow: boolean): void {\n        this.affectsBelow = affectsBelow;\n    }\n}", "import { \n    RenderConfig, \n    WebGLRenderContext, \n    Clip, \n    Effect, \n    ShaderUniform,\n    WebCodecsConfig,\n    ProgressPayload \n} from './types.js';\nimport { TiramisuRenderer } from './webgl/TiramisuRenderer.js';\nimport { TextureManager } from './webgl/TextureManager.js';\nimport { ShaderManager } from './webgl/ShaderManager.js';\nimport { WebCodecsVideoSource } from './webgl/WebCodecsVideoSource.js';\nimport { EffectStack, ClipEffectStack, AdjustmentLayerStack } from './webgl/EffectStack.js';\n\n// Virtual Track System\nexport interface Track {\n    id: string;\n    name: string;\n    zIndex: number;\n    muted: boolean;\n    solo: boolean;\n    clips: WebVideoClip[];\n    adjustmentLayers: AdjustmentLayerStack[];\n}\n\nexport interface WebVideoClip {\n    id: string;\n    source: string; // URL or file path\n    startFrame: number;\n    endFrame: number;\n    track: number;\n    effects: ClipEffectStack;\n    transform?: {\n        x: number;\n        y: number;\n        scaleX: number;\n        scaleY: number;\n        rotation: number;\n    };\n}\n\nexport interface Transition {\n    id: string;\n    fromClipId: string;\n    toClipId: string;\n    type: string; // Transition shader ID\n    duration: number; // in frames\n    uniforms: Record<string, ShaderUniform>;\n}\n\nexport class TiramisuEditor<T = any> {\n    private canvas: HTMLCanvasElement;\n    private config: RenderConfig<T>;\n    \n    // WebGL Components\n    private renderer: TiramisuRenderer;\n    private textureManager: TextureManager;\n    private shaderManager: ShaderManager;\n    private webCodecsSource: WebCodecsVideoSource;\n    \n    // Virtual Track System\n    private tracks: Map<number, Track> = new Map();\n    private adjustmentLayers: Map<number, AdjustmentLayerStack[]> = new Map();\n    \n    // Transitions\n    private transitions: Map<string, Transition> = new Map();\n    \n    // State\n    private currentFrame: number = 0;\n    private isPlaying: boolean = false;\n    private animationFrameId: number | null = null;\n    \n    constructor(options: { canvas: string | HTMLCanvasElement } & Partial<RenderConfig<T>>) {\n        // Setup canvas\n        if (typeof options.canvas === 'string') {\n            this.canvas = document.getElementById(options.canvas) as HTMLCanvasElement;\n        } else {\n            this.canvas = options.canvas;\n        }\n        \n        if (!this.canvas) {\n            throw new Error('TiramisuEditor: Canvas element not found');\n        }\n        \n        // Setup config with defaults\n        this.config = {\n            width: 1920,\n            height: 1080,\n            fps: 30,\n            durationSeconds: 10,\n            webgl: true,\n            webcodecs: true,\n            ...options\n        };\n        \n        // Initialize WebGL components\n        this.renderer = new TiramisuRenderer(this.canvas, this.config);\n        this.textureManager = new TextureManager(this.renderer['gl'], 32);\n        this.shaderManager = new ShaderManager(this.renderer);\n        this.webCodecsSource = new WebCodecsVideoSource();\n        \n        // Initialize with one default track\n        this.createTrack(1, 'Main Track');\n    }\n    \n    // Track Management\n    createTrack(trackId: number, name: string = `Track ${trackId}`): Track {\n        const track: Track = {\n            id: trackId.toString(),\n            name,\n            zIndex: trackId,\n            muted: false,\n            solo: false,\n            clips: [],\n            adjustmentLayers: []\n        };\n        \n        this.tracks.set(trackId, track);\n        return track;\n    }\n    \n    getTrack(trackId: number): Track | undefined {\n        return this.tracks.get(trackId);\n    }\n    \n    getAllTracks(): Track[] {\n        return Array.from(this.tracks.values()).sort((a, b) => a.zIndex - b.zIndex);\n    }\n    \n    // Clip Management\n    addVideo(source: string, options: {\n        start: number;\n        duration: number;\n        track: number;\n    }): WebVideoClip {\n        const clip: WebVideoClip = {\n            id: crypto.randomUUID(),\n            source,\n            startFrame: Math.floor(options.start * this.config.fps),\n            endFrame: Math.floor((options.start + options.duration) * this.config.fps),\n            track: options.track,\n            effects: new ClipEffectStack(crypto.randomUUID()),\n            transform: {\n                x: 0,\n                y: 0,\n                scaleX: 1,\n                scaleY: 1,\n                rotation: 0\n            }\n        };\n        \n        const track = this.tracks.get(options.track);\n        if (track) {\n            track.clips.push(clip);\n            // Sort clips by start frame\n            track.clips.sort((a, b) => a.startFrame - b.startFrame);\n        } else {\n            throw new Error(`Track ${options.track} not found`);\n        }\n        \n        // Load the video source\n        this.webCodecsSource.loadVideo(source, clip.id);\n        \n        return clip;\n    }\n    \n    getClip(clipId: string): WebVideoClip | undefined {\n        for (const track of this.tracks.values()) {\n            const clip = track.clips.find(c => c.id === clipId);\n            if (clip) return clip;\n        }\n        return undefined;\n    }\n    \n    // Effect Management (simplified API for users)\n    addEffectToClip(clipId: string, effectType: string, uniforms: Record<string, ShaderUniform>): void {\n        const clip = this.getClip(clipId);\n        if (!clip) throw new Error(`Clip ${clipId} not found`);\n        \n        let effect: Effect;\n        \n        // Use convenience methods from ShaderManager\n        switch (effectType) {\n            case 'BrightnessContrast':\n                effect = this.shaderManager.createBrightnessEffect(\n                    uniforms.brightness as number || 0,\n                    uniforms.contrast as number || 1\n                );\n                break;\n            case 'Vignette':\n                effect = this.shaderManager.createCustomEffect('vignette', uniforms);\n                break;\n            case 'ChromaKey':\n                effect = this.shaderManager.createChromaKeyEffect(\n                    uniforms.color ? this.hexToRgb(uniforms.color as string) : { r: 0, g: 1, b: 0 },\n                    uniforms.similarity as number || 0.3,\n                    uniforms.softness as number || 0.1,\n                    uniforms.spillReduction as number || 0.5\n                );\n                break;\n            default:\n                effect = this.shaderManager.createCustomEffect(effectType, uniforms);\n        }\n        \n        clip.effects.addEffect(effect);\n    }\n    \n    // Transition Management\n    addTransition(\n        fromClip: WebVideoClip, \n        toClip: WebVideoClip, \n        type: string, \n        options: { duration: number } & Record<string, ShaderUniform> = { duration: 1.0 }\n    ): void {\n        const transition: Transition = {\n            id: crypto.randomUUID(),\n            fromClipId: fromClip.id,\n            toClipId: toClip.id,\n            type,\n            duration: Math.floor(options.duration * this.config.fps),\n            uniforms: { ...options }\n        };\n        delete transition.uniforms.duration; // Remove duration from uniforms\n        \n        this.transitions.set(transition.id, transition);\n    }\n    \n    // Rendering\n    private async renderFrame(frame: number): Promise<void> {\n        const gl = this.renderer['gl'];\n        \n        // Clear the canvas\n        gl.clearColor(0, 0, 0, 1);\n        gl.clear(gl.COLOR_BUFFER_BIT);\n        \n        // Get all visible tracks (respecting solo/mute)\n        const visibleTracks = this.getVisibleTracks();\n        \n        // Render each track\n        for (const track of visibleTracks) {\n            await this.renderTrack(track, frame);\n        }\n        \n        // Apply adjustment layers\n        await this.renderAdjustmentLayers(frame);\n    }\n    \n    private getVisibleTracks(): Track[] {\n        const soloedTracks = Array.from(this.tracks.values()).filter(t => t.solo);\n        \n        if (soloedTracks.length > 0) {\n            return soloedTracks;\n        }\n        \n        return Array.from(this.tracks.values()).filter(t => !t.muted);\n    }\n    \n    private async renderTrack(track: Track, frame: number): Promise<void> {\n        for (const clip of track.clips) {\n            if (frame >= clip.startFrame && frame < clip.endFrame) {\n                await this.renderClip(clip, frame);\n            }\n        }\n    }\n    \n    private async renderClip(clip: WebVideoClip, frame: number): Promise<void> {\n        // Get video frame texture\n        const frameTexture = await this.webCodecsSource.getFrameTexture(\n            clip.id, \n            frame, \n            this.textureManager\n        );\n        \n        if (!frameTexture) return;\n        \n        // Apply clip effects\n        const effects = clip.effects.getActiveEffects();\n        const processedTexture = effects.length > 0 \n            ? this.renderer.renderToTexture(frameTexture, effects)\n            : frameTexture;\n        \n        // Apply transform if present\n        if (clip.transform) {\n            // TODO: Implement transform in shader or vertex manipulation\n        }\n        \n        // Render to canvas\n        this.renderer.renderToCanvas(processedTexture);\n    }\n    \n    private async renderAdjustmentLayers(frame: number): Promise<void> {\n        // TODO: Implement adjustment layers that affect all tracks below\n    }\n    \n    // Playback Controls\n    play(): void {\n        if (this.isPlaying) return;\n        this.isPlaying = true;\n        this.startTime = performance.now() / 1000 - (this.currentFrame / this.config.fps);\n        this.loop();\n    }\n    \n    pause(): void {\n        this.isPlaying = false;\n        if (this.animationFrameId) {\n            cancelAnimationFrame(this.animationFrameId);\n            this.animationFrameId = null;\n        }\n    }\n    \n    seek(timeSeconds: number): void {\n        this.currentFrame = Math.floor(timeSeconds * this.config.fps);\n        this.renderFrame(this.currentFrame);\n    }\n    \n    private startTime: number = 0;\n    private loop(): void {\n        if (!this.isPlaying) return;\n        \n        const currentTime = performance.now() / 1000 - this.startTime;\n        this.currentFrame = Math.floor(currentTime * this.config.fps);\n        \n        if (this.currentFrame >= this.config.fps * this.config.durationSeconds) {\n            this.pause();\n            this.currentFrame = 0;\n            return;\n        }\n        \n        this.renderFrame(this.currentFrame);\n        this.animationFrameId = requestAnimationFrame(() => this.loop());\n    }\n    \n    // Export using WebCodecs\n    async export(onProgress?: (progress: ProgressPayload) => void): Promise<Blob> {\n        const webCodecsConfig: WebCodecsConfig = {\n            codec: 'avc1.42001f', // H.264 baseline profile\n            width: this.config.width,\n            height: this.config.height,\n            bitrate: 5000000, // 5 Mbps\n            framerate: this.config.fps\n        };\n        \n        // TODO: Implement WebCodecs export\n        throw new Error('WebCodecs export not yet implemented');\n    }\n    \n    // Utility methods\n    private hexToRgb(hex: string): { r: number; g: number; b: number } {\n        const result = /^#?([a-f\\d]{2})([a-f\\d]{2})([a-f\\d]{2})$/i.exec(hex);\n        return result ? {\n            r: parseInt(result[1], 16) / 255,\n            g: parseInt(result[2], 16) / 255,\n            b: parseInt(result[3], 16) / 255\n        } : { r: 0, g: 1, b: 0 };\n    }\n    \n    // Cleanup\n    dispose(): void {\n        this.pause();\n        this.renderer.dispose();\n        this.textureManager.dispose();\n        this.shaderManager.dispose();\n        this.webCodecsSource.dispose();\n        this.tracks.clear();\n        this.transitions.clear();\n    }\n}", "import { TiramisuEditor } from '../../src/TiramisuEditor.js';\n\ninterface VideoFile {\n    file: File;\n    url: string;\n    objectUrl: string;\n}\n\nclass WebGLEditorApp {\n    private editor: TiramisuEditor;\n    private video1: VideoFile | null = null;\n    private video2: VideoFile | null = null;\n    private currentClip1: any = null;\n    private currentClip2: any = null;\n    private isPlaying = false;\n\n    constructor() {\n        this.editor = new TiramisuEditor({\n            canvas: 'gl-canvas',\n            width: 1920,\n            height: 1080,\n            fps: 30,\n            durationSeconds: 10,\n            webgl: true,\n            webcodecs: true\n        });\n\n        this.initializeUI();\n        this.setupEventListeners();\n        this.loadSampleVideos();\n    }\n\n    private async loadSampleVideos() {\n        // Create sample video URLs using common test videos\n        const sampleVideos = [\n            'https://commondatastorage.googleapis.com/gtv-videos-bucket/sample/BigBuckBunny.mp4',\n            'https://commondatastorage.googleapis.com/gtv-videos-bucket/sample/ElephantsDream.mp4'\n        ];\n\n        try {\n            // Try to load first sample video automatically\n            const response = await fetch(sampleVideos[0], { method: 'HEAD' });\n            if (response.ok) {\n                // Update video status to show sample video is available\n                this.updateVideoStatus('video1-status', 'Sample video ready (click to use custom video)');\n                \n                // Create a function to load sample when user clicks\n                const loadSampleBtn = document.createElement('button');\n                loadSampleBtn.textContent = 'Load Sample Video';\n                loadSampleBtn.style.marginTop = '5px';\n                loadSampleBtn.onclick = () => this.loadSampleVideo(sampleVideos[0], 1);\n                \n                const video1Status = document.getElementById('video1-status');\n                if (video1Status) {\n                    video1Status.appendChild(loadSampleBtn);\n                }\n            }\n        } catch (error) {\n            console.log('Sample videos not available, please upload your own videos');\n        }\n    }\n\n    private async loadSampleVideo(url: string, videoNumber: number) {\n        try {\n            const videoFile: VideoFile = {\n                file: new File([], 'sample.mp4'),\n                url,\n                objectUrl: url\n            };\n\n            if (videoNumber === 1) {\n                this.video1 = videoFile;\n                this.updateVideoStatus('video1-status', 'Sample video loaded');\n                await this.addVideoToTimeline(this.video1, 0, 5);\n            } else {\n                this.video2 = videoFile;\n                this.updateVideoStatus('video2-status', 'Sample video loaded');\n                await this.addVideoToTimeline(this.video2, 4, 6);\n            }\n        } catch (error) {\n            console.error('Failed to load sample video:', error);\n            this.updateVideoStatus(`video${videoNumber}-status`, 'Failed to load sample video');\n        }\n    }\n\n    private initializeUI() {\n        // Set up initial UI state\n        this.updatePlaybackControls();\n        this.updateSliderValues();\n    }\n\n    private setupEventListeners() {\n        // Video input handlers\n        document.getElementById('video1-input')?.addEventListener('change', (e) => {\n            this.handleVideoUpload(e, 1);\n        });\n\n        document.getElementById('video2-input')?.addEventListener('change', (e) => {\n            this.handleVideoUpload(e, 2);\n        });\n\n        // Playback controls\n        document.getElementById('play-btn')?.addEventListener('click', () => {\n            this.play();\n        });\n\n        document.getElementById('pause-btn')?.addEventListener('click', () => {\n            this.pause();\n        });\n\n        document.getElementById('seek-bar')?.addEventListener('input', (e) => {\n            this.seek((e.target as HTMLInputElement).value);\n        });\n\n        // Adjustment sliders\n        ['brightness', 'contrast', 'saturation'].forEach(id => {\n            document.getElementById(id)?.addEventListener('input', (e) => {\n                this.handleAdjustmentChange(id, (e.target as HTMLInputElement).value);\n            });\n        });\n\n        // Effects buttons\n        document.getElementById('add-grayscale')?.addEventListener('click', () => {\n            this.addGrayscaleEffect();\n        });\n\n        document.getElementById('add-blur')?.addEventListener('click', () => {\n            this.addBlurEffect();\n        });\n\n        document.getElementById('clear-effects')?.addEventListener('click', () => {\n            this.clearAllEffects();\n        });\n\n        // Transition select\n        document.getElementById('transition-select')?.addEventListener('change', (e) => {\n            this.handleTransitionChange((e.target as HTMLSelectElement).value);\n        });\n    }\n\n    private async handleVideoUpload(event: Event, videoNumber: number) {\n        const input = event.target as HTMLInputElement;\n        const file = input.files?.[0];\n        \n        if (!file) return;\n\n        const objectUrl = URL.createObjectURL(file);\n        const videoUrl = URL.createObjectURL(file);\n\n        const videoFile: VideoFile = {\n            file,\n            url: videoUrl,\n            objectUrl\n        };\n\n        try {\n            if (videoNumber === 1) {\n                if (this.video1) {\n                    URL.revokeObjectURL(this.video1.objectUrl);\n                }\n                this.video1 = videoFile;\n                this.updateVideoStatus('video1-status', `${file.name} (${this.formatFileSize(file.size)})`);\n                await this.addVideoToTimeline(this.video1, 0, 5);\n            } else {\n                if (this.video2) {\n                    URL.revokeObjectURL(this.video2.objectUrl);\n                }\n                this.video2 = videoFile;\n                this.updateVideoStatus('video2-status', `${file.name} (${this.formatFileSize(file.size)})`);\n                await this.addVideoToTimeline(this.video2, 4, 6);\n            }\n        } catch (error) {\n            console.error('Failed to load video:', error);\n            this.updateVideoStatus(`video${videoNumber}-status`, `Error: ${error instanceof Error ? error.message : 'Unknown error'}`);\n        }\n    }\n\n    private async addVideoToTimeline(videoFile: VideoFile, start: number, duration: number) {\n        try {\n            const clip = this.editor.addVideo(videoFile.url, {\n                start,\n                duration,\n                track: 1\n            });\n\n            if (videoFile === this.video1) {\n                this.currentClip1 = clip;\n            } else {\n                this.currentClip2 = clip;\n            }\n\n            // Apply initial adjustments\n            this.applyCurrentAdjustments(clip);\n        } catch (error) {\n            console.error('Failed to add video to timeline:', error);\n            this.updateVideoStatus('video1-status', `Error: ${error instanceof Error ? error.message : 'Unknown error'}`);\n        }\n    }\n\n    private handleAdjustmentChange(type: string, value: string) {\n        const numValue = parseFloat(value);\n        const valueElement = document.getElementById(`${type}-value`);\n        if (valueElement) {\n            valueElement.textContent = numValue.toFixed(2);\n        }\n\n        // Apply to both clips\n        if (this.currentClip1) {\n            this.applyAdjustment(this.currentClip1, type, numValue);\n        }\n        if (this.currentClip2) {\n            this.applyAdjustment(this.currentClip2, type, numValue);\n        }\n    }\n\n    private applyAdjustment(clip: any, type: string, value: number) {\n        // Get clip to access its effects\n        const clipData = this.editor.getClip(clip.id);\n        if (!clipData) return;\n        \n        // Clear existing effects by reinitializing effect stack\n        clipData.effects.clearEffects();\n        \n        // Add new effect if value is not default\n        if (type === 'brightness' && value !== 0) {\n            this.editor.addEffectToClip(clip.id, 'BrightnessContrast', { brightness: value, contrast: 1 });\n        } else if (type === 'contrast' && value !== 1) {\n            this.editor.addEffectToClip(clip.id, 'BrightnessContrast', { brightness: 0, contrast: value });\n        } else if (type === 'saturation' && value !== 1) {\n            this.editor.addEffectToClip(clip.id, 'Saturation', { saturation: value });\n        }\n    }\n\n    private applyCurrentAdjustments(clip: any) {\n        const brightness = parseFloat((document.getElementById('brightness') as HTMLInputElement).value);\n        const contrast = parseFloat((document.getElementById('contrast') as HTMLInputElement).value);\n        const saturation = parseFloat((document.getElementById('saturation') as HTMLInputElement).value);\n\n        // Apply all adjustments at once\n        const clipData = this.editor.getClip(clip.id);\n        if (!clipData) return;\n        \n        clipData.effects.clearEffects();\n        \n        if (brightness !== 0) {\n            this.editor.addEffectToClip(clip.id, 'BrightnessContrast', { brightness, contrast: 1 });\n        }\n        if (contrast !== 1) {\n            this.editor.addEffectToClip(clip.id, 'BrightnessContrast', { brightness: 0, contrast });\n        }\n        if (saturation !== 1) {\n            this.editor.addEffectToClip(clip.id, 'Saturation', { saturation });\n        }\n    }\n\n    private addGrayscaleEffect() {\n        if (this.currentClip1) {\n            this.editor.addEffectToClip(this.currentClip1.id, 'Grayscale', { strength: 1.0 });\n        }\n        if (this.currentClip2) {\n            this.editor.addEffectToClip(this.currentClip2.id, 'Grayscale', { strength: 1.0 });\n        }\n    }\n\n    private addBlurEffect() {\n        if (this.currentClip1) {\n            this.editor.addEffectToClip(this.currentClip1.id, 'Blur', { radius: 5.0 });\n        }\n        if (this.currentClip2) {\n            this.editor.addEffectToClip(this.currentClip2.id, 'Blur', { radius: 5.0 });\n        }\n    }\n\n    private clearAllEffects() {\n        if (this.currentClip1) {\n            const clipData = this.editor.getClip(this.currentClip1.id);\n            if (clipData) {\n                clipData.effects.clearEffects();\n                this.applyCurrentAdjustments(this.currentClip1);\n            }\n        }\n        if (this.currentClip2) {\n            const clipData = this.editor.getClip(this.currentClip2.id);\n            if (clipData) {\n                clipData.effects.clearEffects();\n                this.applyCurrentAdjustments(this.currentClip2);\n            }\n        }\n    }\n\n    private handleTransitionChange(transitionType: string) {\n        if (this.currentClip1 && this.currentClip2 && transitionType !== 'none') {\n            this.editor.addTransition(this.currentClip1, this.currentClip2, transitionType, {\n                duration: 1.0,\n                strength: 0.5\n            });\n        }\n    }\n\n    private play() {\n        this.editor.play();\n        this.isPlaying = true;\n        this.updatePlaybackControls();\n        this.startPlaybackLoop();\n    }\n\n    private pause() {\n        this.editor.pause();\n        this.isPlaying = false;\n        this.updatePlaybackControls();\n    }\n\n    private seek(percentage: string) {\n        const duration = 10; // durationSeconds from config\n        const time = (parseFloat(percentage) / 100) * duration;\n        this.editor.seek(time);\n    }\n\n    private startPlaybackLoop() {\n        const updateLoop = () => {\n            if (this.isPlaying) {\n                this.updatePlaybackUI();\n                requestAnimationFrame(updateLoop);\n            }\n        };\n        updateLoop();\n    }\n\n    private updatePlaybackUI() {\n        // Note: TiramisuEditor doesn't expose getCurrentTime/getDuration\n        // For now, we'll use a simplified approach based on config\n        const duration = 10; // durationSeconds from config\n        const currentTime = this.isPlaying ? 0 : 0; // Simplified - would need actual time tracking\n        \n        const percentage = 0; // Simplified - would need actual percentage calculation\n\n        const seekBar = document.getElementById('seek-bar') as HTMLInputElement;\n        const timeDisplay = document.getElementById('time-display');\n\n        if (seekBar) {\n            seekBar.value = percentage.toString();\n        }\n        if (timeDisplay) {\n            timeDisplay.textContent = `${this.formatTime(currentTime)} / ${this.formatTime(duration)}`;\n        }\n    }\n\n    private updatePlaybackControls() {\n        const playBtn = document.getElementById('play-btn') as HTMLButtonElement;\n        const pauseBtn = document.getElementById('pause-btn') as HTMLButtonElement;\n\n        if (playBtn && pauseBtn) {\n            playBtn.disabled = this.isPlaying;\n            pauseBtn.disabled = !this.isPlaying;\n        }\n    }\n\n    private updateSliderValues() {\n        ['brightness', 'contrast', 'saturation'].forEach(id => {\n            const slider = document.getElementById(id) as HTMLInputElement;\n            const valueElement = document.getElementById(`${id}-value`);\n            if (slider && valueElement) {\n                valueElement.textContent = parseFloat(slider.value).toFixed(2);\n            }\n        });\n    }\n\n    private updateVideoStatus(elementId: string, status: string) {\n        const element = document.getElementById(elementId);\n        if (element) {\n            element.textContent = status;\n        }\n    }\n\n    private formatTime(seconds: number): string {\n        const mins = Math.floor(seconds / 60);\n        const secs = Math.floor(seconds % 60);\n        return `${mins}:${secs.toString().padStart(2, '0')}`;\n    }\n\n    private formatFileSize(bytes: number): string {\n        if (bytes === 0) return '0 Bytes';\n        const k = 1024;\n        const sizes = ['Bytes', 'KB', 'MB', 'GB'];\n        const i = Math.floor(Math.log(bytes) / Math.log(k));\n        return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];\n    }\n\n    public dispose() {\n        this.editor.dispose();\n        if (this.video1) {\n            URL.revokeObjectURL(this.video1.objectUrl);\n        }\n        if (this.video2) {\n            URL.revokeObjectURL(this.video2.objectUrl);\n        }\n    }\n}\n\n// Initialize app when DOM is loaded\ndocument.addEventListener('DOMContentLoaded', () => {\n    const app = new WebGLEditorApp();\n    \n    // Make app available globally for debugging\n    (window as any).webglEditorApp = app;\n});\n\nexport { WebGLEditorApp };"],
  "mappings": "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",
  "names": ["effect"]
}
